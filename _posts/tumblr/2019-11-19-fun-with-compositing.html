---
layout: post
title: Fun with Compositing
date: '2019-11-19T21:06:59-05:00'
tags:
- colonycaseus
tumblr_url: https://boxfishdev.tumblr.com/post/189180247329/fun-with-compositing
---
<p>Right now, I’m at a stage of development in Colony Caseus where I’m producing more content instead of coding new stuff. Namely, now that my battle system’s ready and I have all the tools I need to create cool enemies, I’ve been grinding out enemy animations and behavior scripts. The only real technical thing I’ve really been doing is playing around with Blender’s compositing system to make pre-rendered sprites look less out of place. To give you an idea of what I mean, without any post processing, the sprites look like this in-game:</p><figure data-orig-width="100" data-orig-height="120"><img src="https://66.media.tumblr.com/62c12f4f4d5f99c95f9b620a0d64fd02/4c7c314dd7e5afe7-c3/s540x810/225242d7a69b32952261a4826d33cd6742632f8f.gif" data-orig-width="100" data-orig-height="120"/></figure><p>Now, I’m fine with sprites that look slightly off. In fact, I think imperfect sprites enhance the creepiness of the game. What I’m not a fan of is how they remove the retro aesthetic I’m going for. Everything else looks like it belongs in an NES-SNES title, but the enemies look like they belong on the PS1.</p><p>The first thing I decided to change was the anti-aliasing. Blender slightly blurs the borders of sprites, which means I had a “halo” around my enemies.</p><figure class="tmblr-full" data-orig-height="160" data-orig-width="345"><img src="https://66.media.tumblr.com/87beca85ea3ddb30c28d49c5b6caf6a9/4c7c314dd7e5afe7-e6/s540x810/dd12aa878d4213cb03d8dd56976458bda85c2dc5.png" data-orig-height="160" data-orig-width="345"/></figure><p>Obviously, not good. I don’t think even PS1 games had semi-transparent sprites, so it totally screws with my look. Fortunately, getting rid of the border was <a href="https://blender.stackexchange.com/a/3301">pretty easy</a> using the compositor.</p><p>At this point, I had this:</p><figure data-orig-height="106" data-orig-width="96"><img src="https://66.media.tumblr.com/756c67fb030585ee5dd90263332978f2/4c7c314dd7e5afe7-53/s540x810/59370e7a91fc1bdbf16467d86926f3d988787a97.gif" data-orig-height="106" data-orig-width="96"/></figure><p>Much better. Next, I tackled the color issue. In these sprites, there are way too many colors, which is why they look 3d while everything else looks a lot flatter. My first attempt was to use Blender’s color ramp node to limit the colors in the sprite. Here’s what it looked like:</p><figure data-orig-height="112" data-orig-width="94"><img src="https://66.media.tumblr.com/43442c67bea6d8cf03ccbab74c5ea64c/4c7c314dd7e5afe7-a7/s540x810/24117e62b13ea2b639f7b601d9ad97b044ff91d7.gif" data-orig-height="112" data-orig-width="94"/></figure><p>Not too bad. But it suffered from one glaring issue &ndash; I could only assign colors to intensities, not other colors. Basically, I could tell Blender, “make dark regions dark-brown and light regions light-brown”, but I couldn’t say, “make red regions this shade of red, and yellow regions this shade of yellow”. So it was back to the drawing board.</p><p>I finally decided to post-process the whole sheet with Python’s Pillow module. Using Pillow’s quantize function, I was able to reduce all colors down to a palette of most commonly used ones. The result?</p><figure data-orig-height="120" data-orig-width="96"><img src="https://66.media.tumblr.com/b75b89165b053b7aa79c9857871529de/4c7c314dd7e5afe7-7c/s540x810/bd8af55644e78d2bf684607e1878ffa366d1c6e5.gif" data-orig-height="120" data-orig-width="96"/></figure><p>The best one yet!</p><p>In short, Blender’s node system is hella cool, and always remember good old Python exists. Sorry for writing such a short entry, but I’ve got a ton of enemy animations to crank out.<br/></p>
